{% load static %}
{% include 'base.html' %}

{% block style %}
    <link rel="stylesheet" href="{% static 'css/cart_detail.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css">
{% endblock style %}

{% block content %}

<header>
    
    <ul>
        <li><a href="{% url 'home' %}">Home</a></li>
        <li><a href="{% url 'food_list' %}">Menu</a></li>
        <li><a href="{% url 'cart_detail' %}"><i class="fas fa-shopping-cart" style="color:black;font-size:22px;"><span class="badge badge-primary">{{cart|length}}</span></i></a></li>
    </ul>
</header>
<section id="blog-home" class="pt-5 mt-5 container">
    <h2 class="font-weight-bold pt-5">Shopping Cart</h2>
    <hr>
</section>
<section id="cart-container" class="container my-5">
    <table width="100%">
        <thead>
            <tr>
                <td>Remove</td>
                <td>Image</td>
                <td>Food</td>
                <td>Price</td>
                <td>Quantity</td>
                <td>Item Total Price</td>
            </tr>
        </thead>

        <tbody>
            
            {% for item in cart %}
                {% with food=item.food %}
                    <tr>
                        <td>
                            <form method="POST" action="{% url 'cart_remove' food.id %}">
                                {% csrf_token %}
                                <button type='submit'><i class="fas fa-trash-alt"></i></button>
                            </form>
                        </td>
                        <td><img src="{{food.image.url}}" alt=""></td>
                        <td>
                            <h5>{{food.name}}</h5>
                        </td>
                        <td>
                           <h5>{{item.price}} T</h5>
                        </td>
                       <td>
                            <form action="{% url 'cart_add' food.id %}" method="POST">
                                {{item.update_quantity_form.quantity}}
                                {{item.update_quantity_form.override}}
                                <input type="submit" value="Update">
                                {% csrf_token %}
                            </form>
                        </td>
                        <td>
                           <h5>{{item.total_price}}</h5>
                        </td>
                    </tr>
                    
                {% endwith %}
            {% endfor %}
           
        </tbody>
    </table>
</section>

<section id="cart-bottom" class="container">
    <div class="row">
        <div class="coupon col-lg-6 col-md-6 col-12 mb-4">
            <div>
                <form action="{% url 'coupon_apply' %}" method="POST">
                    <h5>COUPON</h5>
                    <p>Enter your coupon code if you have one.</p>
                    {{form}}
                    <button type='submit'>APPLY COUPON</button>
                    {% csrf_token %}
                </form>
            </div>
        </div>
        <div class="total col-lg-6 col-md-6 col-12 ">
            <div>
                <h5>CART TOTAL</h5>
                <div class="d-flex justify-content-between">
                    <h6>Subtotal</h6>
                    <p>{{cart.get_total_price}} T</p>
                </div>
                <div class="d-flex justify-content-between">
                    {% if cart.coupon %}
                       <h6>{{cart.coupon.discount}}% discount: </h6>
                        <p>{{cart.get_discount}} T</p>
                    {% endif %}
                </div>
                <hr class="second-hr">
                <div class="d-flex justify-content-between">
                    <h6>Total</h6>
                    <p>{{cart.get_total_price_after_discount}} T</p>
                </div>
                <button class="ml-auto" ><a href="{% url 'order_create' %}" style="color:#fff;">PROCEED TO CHECKOUT</a></button>
                <button class="ml-auto" ><a href="{% url 'food_list' %}" style="color:#fff;">CONTINUE SHOPPING</a></button>
            </div>
        </div>
    </div>
</section>
{% endblock content %}